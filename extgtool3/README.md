# extgtool3

Extra-gtool3

東京大学大気海洋研究所、国立環境研究所、海洋開発研究機構で開発・維持管理されている気候モデルMIROCで用いられるGTOOL3形式のデータを扱うためのコマンドラインツール集。オリジナルのgtool3とは別のもので、オリジナルの機能拡張を目的に作成した。例えば、オリジナルで提供されていない解析ツールの追加やp面、η面、z面での解析等に対応している。オリジナルのgtool3と一緒に利用することを想定したもので、extgtool3単独ではオリジナルで提供されている機能は利用できない。コマンド名は、オリジナルのgtool3とは重複しないようにしている

## コンパイル

利用する前に、Fortran、Cコンパイラによるコンパイルが必要となる。NetCDFへの変換プログラムも利用するので、コンパイル時にNetCDFライブラリも必要となる

### Mkinclude

コンパイル時の設定を記述する

- **prefix**: インストールを行うディレクトリへのパス

    prefix = $(HOME)/local

- **FC**: Fortranコンパイラ

- **OPTFLAGS**: Fortranコンパイラの最適化オプション

- **FFLAGS**: Fortranコンパイラのオプション

- **FINCLUDE**: Fortranコンパイラに渡すインクルードを記述（-Iパス）

- **CC**: Cコンパイラ

- **COPT**: Cコンパイラのオプション

- **CINCLUDE**: Cコンパイラに渡すインクルードを記述（-Iパス）

### Mkinclude-netcdf

NetCDFライブラリを利用する際の追加設定を記述する

- **NETCDF**: NetCDFライブラリのトップ $(NETCDF)/include がコンパイル時に参照される

- **LIB_NETCDF**: ライブラリをリンクする際の設定

### コンパイルを行う

    % make 
    
    % make install

prefixで指定したディレクトリのbin/以下にインストールされる。インストールされたディレクトリへのパスを通す

## 実行

    % コマンド名　オプション


### ツールの情報取り出し

- **config.sh**: extgtool3のパスを取得する

### 時刻データを扱う

- **day2mon.sh**: 日平均データから月平均データを作成する。1/1から始まっていない場合には正確な結果にならない

- **any2mon.sh**: 何らかの時刻データから月平均データを作成する

- **day0fix.sh**: 複数ファイルの先頭から順に同じ番号のデータを結合する

- **gtcut**: 指定した時刻範囲のデータを取り出す

- **gtmmon**: データに月毎の時刻情報を付ける

- **gtmday**:　データに日毎の時刻情報を付ける

- **gtrepint**: 時刻設定ファイルと時間方向にまばらなデータファイルを使い時間方向に内挿する

- **gtrepint.sh**: gtcutを使い指定した時刻範囲で切り出した後、gtrepintを呼び出し時間方向に内挿する

- **gttsm**: 時空間データの最大、最小か平均を計算

- **gtjoinz**: 時間方向のデータをz方向に結合し直す

### オリジナルのgtool3の座標系拡張

- **gtrelh_p**: 相対湿度を計算する（オリジナルのgtrelhの座標系拡張）

- **gttheta_p**: 温度と温位の変換（オリジナルのgtrelhの座標系拡張）

- **gtthetae_p**: 相当温位の計算（オリジナルのgtrelhの座標系拡張）

### 追加の解析ツール

- **gtdelt**: 時間方向の微分を取る

- **gtzonal**: 帯状平均を計算する

- **gtrunmean**: 移動平均を計算する

### データ形式変換

- **gtconv**: GTOOL3形式、単純バイナリ形式（GrADS形式）に対応。単純バイナリ形式からGTOOL3に変換した際の時刻設定、データのx方向のデータの開始位置シフト、y方向・z方向の逆回し、エンディアン変換等に対応

- **gt2nc**: GTOOL3形式を読み込み、GrADSのsdfopenで読み込み可能なNetCDF形式で書き出す

- **gt2txt**: 1次元のGTOOL3ファイルをテキストファイルに変換する

### データの情報取り出し

- **gtinfo**: GTOOL3ファイルからヘッダ情報を取り出す

- **gtitem**: モデルのSYSINからitemを取り出す

- **histchk**: モデルのSYSIN中のnmhist入力を確認

- **histchk.sh**: モデルのSYSINを取り出し、histchkに渡す

### データの値を変換（単位変換など）

- **gtfact**: データにスケールファクターを掛け、オフセットを足す

- **gtfact.sh**: gtfactを使い、気圧、鉛直p速度などの単位変換を行う

- **gtfmod.sh**: gtfactを使い、海氷密接度などの単位変換を行う。元のGTOOLデータで単位が指定されていない場合にも、オプションで与えることができる

- **gtrange**: データを指定した最小値、最大値の範囲に収める

### データ置換（一定値データ作成）

- **gtconst**: 時空間データを全て一定値で置き換える

- **gtreplace**: 時空間データを同じ大きさの空間データの一定値で置き換える

### 温位面での解析ツール

- **gtintp2th.sh**: p面と温位面の変換

- **gtpvont**: 温位面におけるPVを計算する

- **gtpvsfc**: 指定した温位面のPVを計算

- **gtsteflux**: STE flux関連の計算

- **gttrop**: 対流圏界面高度の計算

### 力学解析ツール

- **gtomg2w**: 鉛直p速度を鉛直速度に変換する

- **gtepflux**:  E-P fluxを計算する

- **gtepfluxwn**: 波数分解したE-P fluxを計算する

- **gtwsta**:  残差循環を計算する

- **gtmage**: ageを計算する

- **gtstab**: 大気の安定度を計算する

###  オゾン層関連の解析ツール

- **gtairmass**: 地表気圧から大気のカラム全量を計算する

- **gtairmassv**: 大気密度から大気のカラム全量を計算する

- **gtcol**: 指定した鉛直レベル範囲でカラム平均量を計算する

- **gtdob**: オゾン混合比(vmr)からオゾン全量(DU)を計算する

- **gtdobl**: オゾン混合比(vmr)と対流圏界面レベルから、対流圏と成層圏のオゾンカラム量を計算する

- **gtps**: 気温(K)、ジオポテンシャル高度(m)、地表面高度(m)から地表気圧(hPa)を計算する

- **gtps2p**: 地表気圧データ(hPa)から3次元の気圧データ(hPa)を計算する

- **gtpsc**: PSCの反応表面積データから、指定した緯度範囲内、高度でPSCが存在する面積を計算する

- **gtpsct**: 気温データから、指定した緯度範囲内、高度、閾値となる気温(195K、188K等)から、PSCが存在しうる面積を計算する


